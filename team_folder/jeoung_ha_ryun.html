<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- jQuery (타이핑에 사용) -->
    <script src="../js/jquery-3.7.1.min.js" defer></script>

    <!-- Bootstrap / Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />

    <!-- 공용 CSS -->
    <link href="../css/common.css" rel="stylesheet" />
    <link href="../css/style.css" rel="stylesheet" />

    <title>3조 : 보람삼조</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');

        :root{
            --bg:#1e1f22;
            --text:#fff;
            --muted:#9aa4ad;
            --card:#22272e;
            --card-border:#2b3138;
            --dock-size:60px;    /* 도크 아이콘 기본 크기 */
            --dock-gap:32px;     /* 도크 간격 */
        }

        body{ background-color:var(--bg); height:100vh; }

        .class_haryun_title{
            color:var(--text);
            font-family:"Do Hyeon",sans-serif;
            font-weight:600;
            font-size:clamp(35px,3.6vw,56px);
            line-height:1.15;
            letter-spacing:3px;
            width:90%;
            margin:0 auto 16px;
        }

        .haryun{
            color:var(--text);
            margin:0 0 0 20px;
            padding:10px;
            border-radius:10px;
            line-height:1.8;
            height:100%;
            font-family:"Gowun Dodum",sans-serif;
            font-size:clamp(15px,1.05vw,18px);
        }

        .my_profile_img{
            margin-top:10px;
            border-radius:10px;
            max-width:60%;
            border:2px solid #ccc;
            cursor:pointer;
        }

        /* 갤러리 */
        .gallery-thumb{
            cursor:pointer;
            transition:transform .2s ease;
            object-fit:cover;
            width:100%;
            height:160px;
            border-radius:8px;
        }
        .gallery-thumb:hover{ transform:scale(1.03); }

        #mainPhoto{ max-height:65vh; object-fit:contain; margin:0 auto; display:block; }

        .gallery-thumb {
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
            height: 160px;
            border-radius: 8px;
            object-fit: cover;  /* 이미지 전용 */
        }

        .gallery-thumb video {
            object-fit: cover;
        }

        /* 도크 */
        .dock{
            display:flex; justify-content:center; align-items:flex-end;
            gap:var(--dock-gap); padding:24px 0; user-select:none;
        }
        .dock-item{ display:flex; align-items:center; justify-content:center; transform-origin:bottom center; transition:transform .12s ease; will-change:transform; cursor:pointer; }
        .dock-item i{ font-size:var(--dock-size); color:#fff; line-height:1; }

        /* 도크 링크 스타일 초기화 */
        #dock a, #dock a:focus, #dock a:active, #dock a:hover, #dock a:visited{
            text-decoration:none !important;
            border:none !important;
            outline:none !important;
            color:inherit !important;
        }

        /* 방명록 카드 */
        #guestbook .list-group-item{ background:var(--card); color:var(--text); border-color:var(--card-border); }
        #guestbook .meta{ font-size:.875rem; color:var(--muted); }
        #guestbook .msg{ white-space:pre-wrap; }
    </style>
</head>

<body class="p-3 border-0">

<!-- 제목 -->
<div class="container mt-4">
    <h1 id="id_haryun_title" class="class_haryun_title"></h1>
</div>

<!-- 소개 + 프로필 이미지 -->
<div class="container">
    <div class="row align-items-start g-4 mt-5">
        <div class="col-12 col-md-6">
            <div class="haryun">
                <p class="class_haryun_text mb-0"></p>
                <p class="haryun_title_2"></p>
            </div>
        </div>

        <div class="col-12 col-md-6 d-flex justify-content-center align-items-start">
            <img id="my_profile_img"
                 src="../img/Jeong_ha_ryun/JHR_Profile_img.JPG"
                 class="img-fluid rounded my_profile_img"
                 alt="정하륜 프로필"
                 data-bs-toggle="modal"
                 data-bs-target="#photoModal" />
        </div>
    </div>

    <!-- 도크 -->
    <div id="dock" class="dock mt-5">
        <a href="https://www.youtube.com/@나는베짱이1114" target="_blank" rel="noopener" class="dock-item"><i class="bi bi-caret-right-square"></i></a>
        <a href="https://velog.io/@jyop1212/posts" target="_blank" rel="noopener" class="dock-item"><i class="bi bi-bootstrap"></i></a>
        <a href="mailto:jyop1212@naver.com?subject=문의드립니다&body=안녕하세요, 정하륜님!" class="dock-item"><i class="bi bi-envelope-arrow-up"></i></a>
        <span class="dock-item"><i class="bi bi-filetype-html"></i></span>
        <span class="dock-item"><i class="bi bi-filetype-css"></i></span>
        <span class="dock-item"><i class="bi bi-filetype-js"></i></span>
        <span class="dock-item"><i class="bi bi-filetype-java"></i></span>
        <span class="dock-item"><i class="bi bi-filetype-sql"></i></span>
    </div>
</div>

<!-- 사진첩 모달 -->
<div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="photoModalLabel">📸 내 사진첩</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="닫기"></button>
            </div>
            <div class="modal-body">
                <!-- 모달 본문ㅎ -->
                <img id="mainPhoto" class="img-fluid rounded mb-3 d-none" alt="선택한 이미지 미리보기">
                <video id="mainVideo" class="img-fluid rounded mb-3 d-none" controls playsinline></video>
                <div class="row g-3">
                    <div class="col-6 col-md-4 col-lg-3"><img src="../img/Jeong_ha_ryun/JHR_danang_img.JPG"      class="gallery-thumb shadow-sm" alt="gallery-01" /></div>
                    <div class="col-6 col-md-4 col-lg-3"><img src="../img/Jeong_ha_ryun/JHR_dubai_img.JPG"     class="gallery-thumb shadow-sm" alt="gallery-02" /></div>
                    <div class="col-6 col-md-4 col-lg-3"><img src="../img/Jeong_ha_ryun/JHR_Fubao_img.jpeg"        class="gallery-thumb shadow-sm" alt="gallery-03" /></div>
                    <div class="col-6 col-md-4 col-lg-3"><img src="../img/Jeong_ha_ryun/JHR_jeju_img.JPG"          class="gallery-thumb shadow-sm" alt="gallery-04" /></div>
                    <div class="col-6 col-md-4 col-lg-3"><img src="../img/Jeong_ha_ryun/JHR_back_img.JPG"          class="gallery-thumb shadow-sm" alt="gallery-04" /></div>
                    <div class="col-6 col-md-4 col-lg-3"><video class="gallery-thumb shadow-sm" muted>
                    <source src="../img/Jeong_ha_ryun/test.MOV" type="video/mp4">
                    </video>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 방명록 -->
<section id="guestbook" class="container mt-5 pb-5">
    <h2 class="text-white fs-3 mb-3">💬 방명록</h2>

    <form id="guestForm" class="row g-2 mb-4">
        <div class="col-12 col-md-3">
            <input id="gbName" class="form-control" type="text" placeholder="이름 (최대 40자)" maxlength="40" required />
        </div>
        <div class="col-12 col-md-7">
            <input id="gbText" class="form-control" type="text" placeholder="한 줄 댓글을 남겨주세요 (최대 500자)" maxlength="500" required />
        </div>
        <div class="col-12 col-md-2 d-grid">
            <button id="gbSubmit" class="btn btn-primary" type="submit">등록</button>
        </div>
        <div class="form-text text-secondary">비속어/광고/도배는 예고 없이 삭제될 수 있습니다.</div>
    </form>

    <ul id="gbList" class="list-group"></ul>
</section>

<!-- 타이핑 + 도크 + 갤러리 -->
<script>
    // ===== 타이핑 텍스트 =====
    const titleText = "{모두에게 도움이 되는 개발자가 되고 싶습니다.}";
    const profileText = `
1 안녕하세요 <span style="color:#ffeb8e;">정하륜 </span> 입니다.<br>2
<br>
3 <span style="color:#ffeb8e;">생년월일 :</span> 1992 . 11 . 14<br>
4 /*다음달 생일입니다 카카오 기프티콘 받습니다^^*/<br>
5 <span style="color:#ffeb8e;">취미 :</span> <span style="color:limegreen;">"노래, 헬스 그리고 코딩~!"</span><br>
6 <span style="color:#ffeb8e;">좋아하는 음식 :</span> <span style="color:limegreen;">"곱창,치킨"</span>
<br>7 /*(모르는 아저씨가 곱창 사준다고 하면 따라 갑니다.)*/<br>
8<br>
9 <span style="color:#ffeb8e;">MBTI :</span> <span style="color:limegreen;">"ENFP"</span><br>
10 <span style="color:#ffeb8e;">혈액형 :</span> <span style="color:limegreen;">"AB"</span><br>
11 <span style="color:#ffeb8e;">if (목표) :</span> <span style="color:crimson;">로또 1등 당첨 후 월세 받아 먹으며 살기</span><br>
12 <span style="color:#ffeb8e;">eles if (그것도 아니면) :</span> <span style="color:crimson;">개발자로 열심히 일해서 입에 풀칠하기</span><br>
13 <span style="color:#ffeb8e;">eles (그렇다면) :</span> 염라대왕 면담 하러 먼저 갑니다~</span><br>
14 <span style="color:#ffeb8e;">자기소개 :</span>
`;
    const Selfintroduction = ` 15 엔터테인먼트에서 매니저로써 오랫동안 일했었고<br />
16 항상 많은 사람들과 부딫히며 팀워크가 얼마나 중요한지 알게 되었습니다.<br />
17 자신을 위해 일하고 싶다는 마음에 백엔드 개발자로 직종 전환을 선택하였습니다.<br />
18 아직 누군가에게 짐이될수도 있겠지만 언젠가는 개발자와 세상 모두에게 도움을<br />
19 줄수있는 개발자가 되고싶습니다.`;

    const titleSpeed = 90, profileSpeed = 18, introductionSpeed = 0;
    let ti = 0, pi = 0, ii = 0;

    function typingTitle(){
        if(ti <= titleText.length){
            $('#id_haryun_title').text(titleText.slice(0, ti++));
            setTimeout(typingTitle, titleSpeed);
        }else{
            typingProfile();
        }
    }
    function typingProfile(){
        if(pi === 0) $('.class_haryun_text').html('');
        if(pi <= profileText.length){
            $('.class_haryun_text').html(profileText.slice(0, pi++));
            setTimeout(typingProfile, profileSpeed);
        }else{
            typingIntroduction();
        }
    }
    function typingIntroduction(){
        if(ii === 0) $('.haryun_title_2').html('');
        if(ii <= Selfintroduction.length){
            $('.haryun_title_2').html(Selfintroduction.slice(0, ii++));
            setTimeout(typingIntroduction, introductionSpeed);
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof typingTitle === 'function') typingTitle();
    // ===== 도크 확대 효과 =====
        const dock = document.getElementById('dock');
        if(dock){
        const items = Array.from(dock.querySelectorAll('.dock-item'));
        const MAX_SCALE = 1.8, INFLUENCE = 120, LIFT_PX = 40;

        function updateScale(clientX){
            const rect = dock.getBoundingClientRect();
            const x = clientX - rect.left;
            items.forEach(el=>{
                const r = el.getBoundingClientRect();
                const centerX = (r.left + r.right)/2 - rect.left;
                const dist = Math.abs(x - centerX);
                let scale = MAX_SCALE - (dist/INFLUENCE);
                scale = Math.max(1, Math.min(MAX_SCALE, scale));
                const lift = (scale - 1) / (MAX_SCALE - 1) * LIFT_PX;
                el.style.transform = `translateY(${-lift}px) scale(${scale})`;
            });
        }
        dock.addEventListener('mousemove', e => updateScale(e.clientX));
        dock.addEventListener('mouseleave', () => items.forEach(el=> el.style.transform = 'translateY(0) scale(1)'));
    }

        // === 썸네일 클릭 → 메인 미리보기로 띄우기 ===
            const mainImg = document.getElementById("mainPhoto");
            const mainVid = document.getElementById("mainVideo");

            document.querySelectorAll(".gallery-thumb").forEach((thumb) => {
                thumb.addEventListener("click", () => {
                    // 초기화
                    if (mainImg) { mainImg.classList.add("d-none"); mainImg.removeAttribute("src"); }
                    if (mainVid) { mainVid.pause?.(); mainVid.currentTime = 0; mainVid.classList.add("d-none");
                        mainVid.removeAttribute("src"); }

                    if (thumb.tagName === "IMG" && mainImg) {
                        mainImg.src = thumb.src;
                        mainImg.classList.remove("d-none");
                    } else if (thumb.tagName === "VIDEO" && mainVid) {
                        const source = thumb.querySelector("source");
                        if (source) {
                            mainVid.src = source.src;
                            mainVid.classList.remove("d-none");
                            mainVid.play?.();
                    }
                }
            });
            });
            // 모달 닫힐 때 초기화
            const modalEl = document.getElementById("photoModal");
            if (modalEl){
                modalEl.addEventListener("hidden.bs.modal", () => {
                    if (mainImg) { mainImg.classList.add("d-none"); mainImg.removeAttribute("src"); }
                    if (mainVid) { mainVid.pause?.(); mainVid.currentTime = 0; mainVid.classList.add("d-none");mainVid.removeAttribute("src"); }
                });
        }
    });

</script>

<!-- Firebase (모듈) : Firestore 댓글 -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDeTN6nt6LiVTEY0l8K2HurlV9N6kPkelU",
        authDomain: "haryun-6fd5c.firebaseapp.com",
        projectId: "haryun-6fd5c",
        storageBucket: "haryun-6fd5c.firebasestorage.app",
        messagingSenderId: "765346047659",
        appId: "1:765346047659:web:68772657c5e937f66839ee",
        measurementId: "G-PJZXS8KKYD"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const $form = document.getElementById('guestForm');
    const $name = document.getElementById('gbName');
    const $text = document.getElementById('gbText');
    const $submit = document.getElementById('gbSubmit');
    const $list = document.getElementById('gbList');

    // 작성
    $form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        if(!$name.value.trim() || !$text.value.trim()) return;
        $submit.disabled = true;
        try{
            await addDoc(collection(db,'guestbook'),{
                name:$name.value.trim(),
                text:$text.value.trim(),
                createdAt:serverTimestamp()
            });
            $text.value = '';
        }catch(err){
            console.error(err);
            alert('등록 중 오류가 발생했습니다.');
        }finally{
            $submit.disabled = false;
        }
    });

    // 실시간 목록
    const q = query(collection(db,'guestbook'), orderBy('createdAt','desc'));
    onSnapshot(q, (snap)=>{
        $list.innerHTML = '';
        snap.forEach(docSnap=>{
            const d = docSnap.data();
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-start';
            li.innerHTML = `
          <div class="me-2">
            <div><strong>${escapeHtml(d.name || '익명')}</strong></div>
            <div class="msg">${escapeHtml(d.text || '')}</div>
            <div class="meta">${formatDate(d.createdAt)}</div>
          </div>`;
            $list.appendChild(li);
        });
    });

    // utils
    function escapeHtml(str){
        return (str || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function formatDate(ts){
        if(!ts?.toDate) return '';
        const d = ts.toDate();
        const pad = n => n.toString().padStart(2,'0');
        return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
